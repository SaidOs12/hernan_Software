<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="robots" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="W3crm:Customer Relationship Management Admin Bootstrap 5 Template">
    <meta property="og:title" content="W3crm:Customer Relationship Management Admin Bootstrap 5 Template">
    <meta property="og:description" content="W3crm:Customer Relationship Management Admin Bootstrap 5 Template">
    <meta name="format-detection" content="telephone=no">
    <!-- PAGE TITLE HERE -->
    <title>Frigorifico la frontera</title>
    <link href="vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style1.css">
    <link rel="stylesheet" href="css/master.css">
</head>
{{> header}}
<body>
    <h1>Peso Actual</h1>
    <input type="text" id="pesoInput" readonly>
    <button id="conectar">Conectar</button>
    
    <script>
        const conectarBoton = document.getElementById('conectar');
        const pesoInput = document.getElementById('pesoInput');
        let port;
        let reader;

        conectarBoton.addEventListener('click', async () => {
            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 9600 });
                conectarBoton.textContent = 'Conectado';
                conectarBoton.disabled = true;

                while (port.readable) {
                    reader = port.readable.getReader();
                    try {
                        while (true) {
                            const { value, done } = await reader.read();
                            if (done) break;
                            const peso = new TextDecoder().decode(value).trim();
                            if (peso) {
                                pesoInput.value = peso + ' g';
                            }
                        }
                    } catch (error) {
                        console.error(error);
                    } finally {
                        reader.releaseLock();
                    }
                }
            } catch (error) {
                console.error('Error al abrir el puerto:', error);
            }
        });
    </script>
    <div class="login-box">
        <img src='https://i.ibb.co/6wpfqns/48dfe62d-2432-42d1-8c93-7922b42f75ae.jpg' class="avatar" alt="Avatar Image">
        <h1>Bienvenido al inicio de Sesion</h1>
        <h3>SISTEMA DE GESTIÓN DE DECOMISOS</h3>
        <form action="/login" method="POST">  
            <!-- USERNAME INPUT -->
            <label for="email">Cedula</label>
            <input type="text" name="cedula" placeholder="Digité su numero de Identidad" required>
            <!-- PASSWORD INPUT -->
            <label for="password">Contraseña</label>
            <input type="password" name="password" placeholder="Digité su Contraseña" required>
            <input type="submit" value="Ingresar">
            
        </form>
        <a href="/registro">¿No tiene una cuenta?</a>
    </div>
    <h1>Peso Actual</h1>
    <input type="text" id="pesoInput" readonly>
    <button id="conectar">Conectar</button>
    
    <script>
        const conectarBoton = document.getElementById('conectar');
        const pesoInput = document.getElementById('pesoInput');
        let port;
        let reader;

        conectarBoton.addEventListener('click', async () => {
            try {
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 9600 });
                conectarBoton.textContent = 'Conectado';
                conectarBoton.disabled = true;

                while (port.readable) {
                    reader = port.readable.getReader();
                    try {
                        while (true) {
                            const { value, done } = await reader.read();
                            if (done) break;
                            const peso = new TextDecoder().decode(value).trim();
                            if (peso) {
                                pesoInput.value = peso + ' g';
                            }
                        }
                    } catch (error) {
                        console.error(error);
                    } finally {
                        reader.releaseLock();
                    }
                }
            } catch (error) {
                console.error('Error al abrir el puerto:', error);
            }
        });
    </script>
</body>
</html>
